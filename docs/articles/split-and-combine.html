<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced: How to use pipeflow with split data sets • pipeflow</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Advanced: How to use pipeflow with split data sets">
<meta property="og:description" content="Shows how you easily apply pipelines at multiple data sets and then combine the output at the end of the pipeline.
">
<meta property="og:image" content="https://github.com/rpahl/pipeflow/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pipeflow</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>

  </a>
</li>
<li>
  <a href="../articles/get-started.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a></a>
    </li>
    <li>
      <a href="../articles/index.html">Overview</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Get started</li>
    <li>
      <a href="../articles/get-started.html">Get started with pipeflow</a>
    </li>
    <li>
      <a href="../articles/modify-pipeline.html">Modifying existing pipelines</a>
    </li>
    <li>
      <a href="../articles/combine-pipelines.html">Combining pipelines</a>
    </li>
    <li>
      <a href="../articles/collect-output.html">Collecting pipeline output</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Advanced</li>
    <li>
      <a href="../articles/split-and-combine.html">How to use pipelines with split data sets</a>
    </li>
    <li>
      <a href="../articles/self-modify-pipeline.html">How pipelines can modify themselves at runtime</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    My packages

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://rpahl.github.io/container/" class="external-link">container</a>
    </li>
    <li>
      <a href="https://rpahl.github.io/GroupSeq/" class="external-link">GroupSeq</a>
    </li>
    <li>
      <a href="https://rpahl.github.io/pipeflow/" class="external-link">pipeflow</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rpahl/pipeflow/">
    <span class="fab fa-github"></span>

  </a>
</li>
<li>
  <a href="https://stackoverflow.com/users/8120617/rpahl" class="external-link">
    <span class="fab fa-stack-overflow"></span>

  </a>
</li>
<li>
  <a href="https://bsky.app/profile/rpahl.bsky.social" class="external-link">
    <span class="fab fa-bluesky"></span>

  </a>
</li>
<li>
  <a href="https://rpahl.github.io/r-some-blog/" class="external-link">
    <span class="fas fa-blog"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><script src="split-and-combine_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="split-and-combine_files/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="split-and-combine_files/vis-9.1.0/vis-network.min.js"></script><script src="split-and-combine_files/visNetwork-binding-2.1.2/visNetwork.js"></script><link href="split-and-combine_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Advanced: How to use pipeflow with split data
sets</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rpahl/pipeflow/blob/HEAD/vignettes/split-and-combine.Rmd"><code>vignettes/split-and-combine.Rmd</code></a></small>
      <div class="hidden name"><code>split-and-combine.Rmd</code></div>

    </div>

    
    
<div class="section level3">
<h3 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h3>
<p>A common scenario is to split a data set into subsets and then apply
the same analysis to each part. In context of pipelines, this means that
we would like to apply the same pipeline multiple times to each data
subset. In additon, we may then want to combine parts of the individual
output. As we will see, <code>pipeflow</code> provides a built-in
function to handle this scenario.</p>
</div>
<div class="section level3">
<h3 id="define-pipeline">Define pipeline<a class="anchor" aria-label="anchor" href="#define-pipeline"></a>
</h3>
<p>Let’s first define our pipeline, which, to keep matters simple, just
fits a linear model and outputs the model coefficients.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpahl.github.io/pipeflow/" class="external-link">pipeflow</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">pip</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pipelineAliases.html">pipe_new</a></span><span class="op">(</span></span>
<span>        <span class="st">"my-pipeline"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span>    <span class="fu"><a href="../reference/pipelineAliases.html">pipe_add</a></span><span class="op">(</span></span>
<span>        <span class="st">"fit"</span>,</span>
<span>        <span class="kw">function</span><span class="op">(</span></span>
<span>            <span class="va">data</span> <span class="op">=</span> <span class="op">~</span><span class="va">data</span>,</span>
<span>            <span class="va">xVar</span> <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>            <span class="va">yVar</span> <span class="op">=</span> <span class="st">"y"</span></span>
<span>        <span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">yVar</span>, <span class="st">"~"</span>, <span class="va">xVar</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span>    <span class="fu"><a href="../reference/pipelineAliases.html">pipe_add</a></span><span class="op">(</span></span>
<span>        <span class="st">"coefs"</span>,</span>
<span>        <span class="kw">function</span><span class="op">(</span></span>
<span>            <span class="va">fit</span> <span class="op">=</span> <span class="op">~</span><span class="va">fit</span></span>
<span>        <span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coefficients</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span>        <span class="op">}</span>,</span>
<span>        keepOut <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p>So our pipeline looks like this:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pip</span></span>
<span><span class="co">#      step depends    out keepOut  group  state</span></span>
<span><span class="co">#    &lt;char&gt;  &lt;list&gt; &lt;list&gt;  &lt;lgcl&gt; &lt;char&gt; &lt;char&gt;</span></span>
<span><span class="co"># 1:   data         [NULL]   FALSE   data    New</span></span>
<span><span class="co"># 2:    fit    data [NULL]   FALSE    fit    New</span></span>
<span><span class="co"># 3:  coefs     fit [NULL]    TRUE  coefs    New</span></span></code></pre></div>
<p>Or graphically:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://datastorm-open.github.io/visNetwork/" class="external-link">visNetwork</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">visNetwork</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pip</span><span class="op">$</span><span class="fu">get_graph</span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visHierarchicalLayout.html" class="external-link">visHierarchicalLayout</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"LR"</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:700px;height:100px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"nodes":{"id":[1,2,3],"label":["data","fit","coefs"],"group":["data","fit","coefs"],"shape":["database","box","circle"],"color":["lightblue","lightblue","lightblue"],"title":["<p><\/p>","<p><\/p>","<p><\/p>"]},"edges":{"from":[1,2],"to":[2,3],"arrows":["to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot"},"manipulation":{"enabled":false},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":["data","fit","coefs"],"width":null,"height":100,"idselection":{"enabled":false},"byselection":{"enabled":false},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)"},"evals":[],"jsHooks":[]}</script><p>We use the <code>iris</code> data set as our working example.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="co">#   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span><span class="co"># 1          5.1         3.5          1.4         0.2  setosa</span></span>
<span><span class="co"># 2          4.9         3.0          1.4         0.2  setosa</span></span>
<span><span class="co"># 3          4.7         3.2          1.3         0.2  setosa</span></span>
<span><span class="co"># 4          4.6         3.1          1.5         0.2  setosa</span></span>
<span><span class="co"># 5          5.0         3.6          1.4         0.2  setosa</span></span>
<span><span class="co"># 6          5.4         3.9          1.7         0.4  setosa</span></span></code></pre></div>
<p>First, we apply the pipeline to the whole data set.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pip</span><span class="op">$</span><span class="fu">set_data</span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="va">pip</span><span class="op">$</span><span class="fu">set_params</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>xVar <span class="op">=</span> <span class="st">"Sepal.Length"</span>, yVar <span class="op">=</span> <span class="st">"Sepal.Width"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pip</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.139] Start run of 'my-pipeline' pipeline:</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.164] Step 1/3 data</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.175] Step 2/3 fit</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.194] Step 3/3 coefs</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.195] Finished execution of steps.</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.196] Done.</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pip</span><span class="op">$</span><span class="fu">collect_out</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># $coefs</span></span>
<span><span class="co">#  (Intercept) Sepal.Length </span></span>
<span><span class="co">#    3.4189468   -0.0618848</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="split-data-set">Split data set<a class="anchor" aria-label="anchor" href="#split-data-set"></a>
</h3>
<p>Next, we want to apply the pipeline to each species separately. One
way to do this would be to use R’s <code>split</code> function. We can
split it by the <code>Species</code> column and then run the pipeline
for each subset. For example:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run_pipeline</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">pip</span><span class="op">$</span><span class="fu">set_data</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span>    <span class="va">pip</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">pip</span><span class="op">$</span><span class="fu">collect_out</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">iris</span>, <span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="va">run_pipeline</span><span class="op">)</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.332] Start run of 'my-pipeline' pipeline:</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.333] Step 1/3 data</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.335] Step 2/3 fit</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.339] Step 3/3 coefs</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.343] Finished execution of steps.</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.344] Done.</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.360] Start run of 'my-pipeline' pipeline:</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.361] Step 1/3 data</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.363] Step 2/3 fit</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.366] Step 3/3 coefs</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.367] Finished execution of steps.</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.367] Done.</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.370] Start run of 'my-pipeline' pipeline:</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.371] Step 1/3 data</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.373] Step 2/3 fit</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.375] Step 3/3 coefs</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.376] Finished execution of steps.</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.377] Done.</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span></span>
<span><span class="co"># $setosa</span></span>
<span><span class="co"># $setosa$coefs</span></span>
<span><span class="co">#  (Intercept) Sepal.Length </span></span>
<span><span class="co">#   -0.5694327    0.7985283 </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $versicolor</span></span>
<span><span class="co"># $versicolor$coefs</span></span>
<span><span class="co">#  (Intercept) Sepal.Length </span></span>
<span><span class="co">#    0.8721460    0.3197193 </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $virginica</span></span>
<span><span class="co"># $virginica$coefs</span></span>
<span><span class="co">#  (Intercept) Sepal.Length </span></span>
<span><span class="co">#    1.4463054    0.2318905</span></span></code></pre></div>
<p>Unfortunately, with this approach we had to create additional code
that had to be run outside the pipeline framework. Let’s now see how to
handle this scenario within the pipeline framework.</p>
<p>As a reminder, our pipeline looks like this:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pip</span></span>
<span><span class="co">#      step depends                 out keepOut  group  state</span></span>
<span><span class="co">#    &lt;char&gt;  &lt;list&gt;              &lt;list&gt;  &lt;lgcl&gt; &lt;char&gt; &lt;char&gt;</span></span>
<span><span class="co"># 1:   data          &lt;data.frame[50x5]&gt;   FALSE   data   Done</span></span>
<span><span class="co"># 2:    fit    data            &lt;lm[12]&gt;   FALSE    fit   Done</span></span>
<span><span class="co"># 3:  coefs     fit 1.4463054,0.2318905    TRUE  coefs   Done</span></span></code></pre></div>
<p>To deal with split data sets, we use the built-in function
<code>set_data_split</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">splitData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">iris</span>, <span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></span>
<span><span class="va">pip</span><span class="op">$</span><span class="fu">set_data_split</span><span class="op">(</span><span class="va">splitData</span><span class="op">)</span></span></code></pre></div>
<p>This function actually transforms the pipeline:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pip</span></span>
<span><span class="co">#                step         depends                 out keepOut      group    state</span></span>
<span><span class="co">#              &lt;char&gt;          &lt;list&gt;              &lt;list&gt;  &lt;lgcl&gt;     &lt;char&gt;   &lt;char&gt;</span></span>
<span><span class="co"># 1:      data.setosa                              [NULL]   FALSE     setosa      New</span></span>
<span><span class="co"># 2:       fit.setosa     data.setosa            &lt;lm[12]&gt;   FALSE     setosa Outdated</span></span>
<span><span class="co"># 3:     coefs.setosa      fit.setosa 1.4463054,0.2318905    TRUE     setosa Outdated</span></span>
<span><span class="co"># 4:  data.versicolor                              [NULL]   FALSE versicolor      New</span></span>
<span><span class="co"># 5:   fit.versicolor data.versicolor            &lt;lm[12]&gt;   FALSE versicolor Outdated</span></span>
<span><span class="co"># 6: coefs.versicolor  fit.versicolor 1.4463054,0.2318905    TRUE versicolor Outdated</span></span>
<span><span class="co"># 7:   data.virginica                              [NULL]   FALSE  virginica      New</span></span>
<span><span class="co"># 8:    fit.virginica  data.virginica            &lt;lm[12]&gt;   FALSE  virginica Outdated</span></span>
<span><span class="co"># 9:  coefs.virginica   fit.virginica 1.4463054,0.2318905    TRUE  virginica Outdated</span></span></code></pre></div>
<p>As we can see, the pipeline now has replicated itself for each data
subset.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">visNetwork</span>, args <span class="op">=</span> <span class="va">pip</span><span class="op">$</span><span class="fu">get_graph</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visHierarchicalLayout.html" class="external-link">visHierarchicalLayout</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"LR"</span>, sortMethod <span class="op">=</span> <span class="st">"directed"</span><span class="op">)</span></span></code></pre></div>
<div class="visNetwork html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"nodes":{"id":[1,2,3,4,5,6,7,8,9],"label":["data.setosa","fit.setosa","coefs.setosa","data.versicolor","fit.versicolor","coefs.versicolor","data.virginica","fit.virginica","coefs.virginica"],"group":["setosa","setosa","setosa","versicolor","versicolor","versicolor","virginica","virginica","virginica"],"shape":["database","box","circle","database","box","circle","database","box","circle"],"color":["lightblue","orange","orange","lightblue","orange","orange","lightblue","orange","orange"],"title":["<p><\/p>","<p><\/p>","<p><\/p>","<p><\/p>","<p><\/p>","<p><\/p>","<p><\/p>","<p><\/p>","<p><\/p>"]},"edges":{"from":[1,2,4,5,7,8],"to":[2,3,5,6,8,9],"arrows":["to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot"},"manipulation":{"enabled":false},"layout":{"hierarchical":{"enabled":true,"direction":"LR","sortMethod":"directed"}}},"groups":["setosa","versicolor","virginica"],"width":null,"height":null,"idselection":{"enabled":false},"byselection":{"enabled":false},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)"},"evals":[],"jsHooks":[]}</script><p>Note that <code>set_data_split</code> accepts any list of data
frames, not just the output of <code>split</code>. Now let’s run this
pipeline.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pip</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.846] Start run of 'my-pipeline' pipeline:</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.847] Step 1/9 data.setosa</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.849] Step 2/9 fit.setosa</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.851] Step 3/9 coefs.setosa</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.853] Step 4/9 data.versicolor</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.855] Step 5/9 fit.versicolor</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.857] Step 6/9 coefs.versicolor</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.859] Step 7/9 data.virginica</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.861] Step 8/9 fit.virginica</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.863] Step 9/9 coefs.virginica</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.865] Finished execution of steps.</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:08.865] Done.</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pip</span><span class="op">$</span><span class="fu">collect_out</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># $setosa</span></span>
<span><span class="co">#  (Intercept) Sepal.Length </span></span>
<span><span class="co">#   -0.5694327    0.7985283 </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $versicolor</span></span>
<span><span class="co">#  (Intercept) Sepal.Length </span></span>
<span><span class="co">#    0.8721460    0.3197193 </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $virginica</span></span>
<span><span class="co">#  (Intercept) Sepal.Length </span></span>
<span><span class="co">#    1.4463054    0.2318905</span></span></code></pre></div>
<p>As we can see, the output is now the same as before but was obtained
without the need to write additional code outside the pipeline
framework.</p>
<p>Finally, as a side note there is another built-in function named
<code>split</code>, which can be used to split the pipeline into its
independent parts. While this works for any pipeline, in our working
example, it naturally will split the pipeline into the parts defined by
the data split.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pip</span><span class="op">$</span><span class="fu">split</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># [[1]]</span></span>
<span><span class="co">#            step     depends                   out keepOut  group  state</span></span>
<span><span class="co">#          &lt;char&gt;      &lt;list&gt;                &lt;list&gt;  &lt;lgcl&gt; &lt;char&gt; &lt;char&gt;</span></span>
<span><span class="co"># 1:  data.setosa                &lt;data.frame[50x5]&gt;   FALSE setosa   Done</span></span>
<span><span class="co"># 2:   fit.setosa data.setosa              &lt;lm[12]&gt;   FALSE setosa   Done</span></span>
<span><span class="co"># 3: coefs.setosa  fit.setosa -0.5694327, 0.7985283    TRUE setosa   Done</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># [[2]]</span></span>
<span><span class="co">#                step         depends                 out keepOut      group  state</span></span>
<span><span class="co">#              &lt;char&gt;          &lt;list&gt;              &lt;list&gt;  &lt;lgcl&gt;     &lt;char&gt; &lt;char&gt;</span></span>
<span><span class="co"># 1:  data.versicolor                  &lt;data.frame[50x5]&gt;   FALSE versicolor   Done</span></span>
<span><span class="co"># 2:   fit.versicolor data.versicolor            &lt;lm[12]&gt;   FALSE versicolor   Done</span></span>
<span><span class="co"># 3: coefs.versicolor  fit.versicolor 0.8721460,0.3197193    TRUE versicolor   Done</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># [[3]]</span></span>
<span><span class="co">#               step        depends                 out keepOut     group  state</span></span>
<span><span class="co">#             &lt;char&gt;         &lt;list&gt;              &lt;list&gt;  &lt;lgcl&gt;    &lt;char&gt; &lt;char&gt;</span></span>
<span><span class="co"># 1:  data.virginica                 &lt;data.frame[50x5]&gt;   FALSE virginica   Done</span></span>
<span><span class="co"># 2:   fit.virginica data.virginica            &lt;lm[12]&gt;   FALSE virginica   Done</span></span>
<span><span class="co"># 3: coefs.virginica  fit.virginica 1.4463054,0.2318905    TRUE virginica   Done</span></span></code></pre></div>
<p>This function is especially useful if you want separate parts of the
pipeline code in order to run them in parallel.</p>
</div>
<div class="section level3">
<h3 id="combine-output">Combine output<a class="anchor" aria-label="anchor" href="#combine-output"></a>
</h3>
<p>In some cases, we may want to (re-)combine the output of the pipeline
parts. For example, we may want to combine the coefficients of the
linear models into one table.</p>
<p>Let’s for this matter extend our pipeline by one step at the end.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pip</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pipelineAliases.html">pipe_new</a></span><span class="op">(</span></span>
<span>        <span class="st">"my-pipeline"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span>    <span class="fu"><a href="../reference/pipelineAliases.html">pipe_add</a></span><span class="op">(</span></span>
<span>        <span class="st">"fit"</span>,</span>
<span>        <span class="kw">function</span><span class="op">(</span></span>
<span>            <span class="va">data</span> <span class="op">=</span> <span class="op">~</span><span class="va">data</span>,</span>
<span>            <span class="va">xVar</span> <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>            <span class="va">yVar</span> <span class="op">=</span> <span class="st">"y"</span></span>
<span>        <span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">yVar</span>, <span class="st">"~"</span>, <span class="va">xVar</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span>    <span class="fu"><a href="../reference/pipelineAliases.html">pipe_add</a></span><span class="op">(</span></span>
<span>        <span class="st">"coefs"</span>,</span>
<span>        <span class="kw">function</span><span class="op">(</span></span>
<span>            <span class="va">fit</span> <span class="op">=</span> <span class="op">~</span><span class="va">fit</span></span>
<span>        <span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coefficients</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">)</span>  <span class="op">|&gt;</span></span>
<span></span>
<span>    <span class="fu"><a href="../reference/pipelineAliases.html">pipe_add</a></span><span class="op">(</span></span>
<span>        <span class="st">"combine_coefs"</span>,</span>
<span>        <span class="kw">function</span><span class="op">(</span></span>
<span>            <span class="va">coefs</span> <span class="op">=</span> <span class="op">~</span><span class="va">coefs</span></span>
<span>        <span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">coefs</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, args <span class="op">=</span> <span class="va">_</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">}</span>,</span>
<span>        keepOut <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p>Here is how the pipeline looks for now.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pip</span></span>
<span><span class="co">#             step depends    out keepOut         group  state</span></span>
<span><span class="co">#           &lt;char&gt;  &lt;list&gt; &lt;list&gt;  &lt;lgcl&gt;        &lt;char&gt; &lt;char&gt;</span></span>
<span><span class="co"># 1:          data         [NULL]   FALSE          data    New</span></span>
<span><span class="co"># 2:           fit    data [NULL]   FALSE           fit    New</span></span>
<span><span class="co"># 3:         coefs     fit [NULL]   FALSE         coefs    New</span></span>
<span><span class="co"># 4: combine_coefs   coefs [NULL]    TRUE combine_coefs    New</span></span></code></pre></div>
<p>Next we again want to apply the <code>set_data_split</code> function,
but we basically need to make sure that the pipeline is split up
<em>except</em> for the last step that combines everything. We achieve
this by using the <code>toStep</code> parameter, which basically tells
the pipeline to split up to a certain step.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pip</span><span class="op">$</span><span class="fu">set_data_split</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">iris</span>, <span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span>, toStep <span class="op">=</span> <span class="st">"coefs"</span><span class="op">)</span></span>
<span><span class="va">pip</span></span>
<span><span class="co">#                 step         depends    out keepOut         group    state</span></span>
<span><span class="co">#               &lt;char&gt;          &lt;list&gt; &lt;list&gt;  &lt;lgcl&gt;        &lt;char&gt;   &lt;char&gt;</span></span>
<span><span class="co">#  1:      data.setosa                 [NULL]   FALSE        setosa      New</span></span>
<span><span class="co">#  2:       fit.setosa     data.setosa [NULL]   FALSE        setosa Outdated</span></span>
<span><span class="co">#  3:     coefs.setosa      fit.setosa [NULL]   FALSE        setosa Outdated</span></span>
<span><span class="co">#  4:  data.versicolor                 [NULL]   FALSE    versicolor      New</span></span>
<span><span class="co">#  5:   fit.versicolor data.versicolor [NULL]   FALSE    versicolor Outdated</span></span>
<span><span class="co">#  6: coefs.versicolor  fit.versicolor [NULL]   FALSE    versicolor Outdated</span></span>
<span><span class="co">#  7:   data.virginica                 [NULL]   FALSE     virginica      New</span></span>
<span><span class="co">#  8:    fit.virginica  data.virginica [NULL]   FALSE     virginica Outdated</span></span>
<span><span class="co">#  9:  coefs.virginica   fit.virginica [NULL]   FALSE     virginica Outdated</span></span>
<span><span class="co"># 10:    combine_coefs       &lt;list[1]&gt; [NULL]    TRUE combine_coefs      New</span></span></code></pre></div>
<p>We see that the last step is not replicated for each data subset and
it now contains a list of dependencies, namely:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pip</span><span class="op">$</span><span class="fu">get_depends</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="st">"combine_coefs"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co"># $coefs</span></span>
<span><span class="co"># [1] "coefs.setosa"     "coefs.versicolor" "coefs.virginica"</span></span></code></pre></div>
<p>Graphically it becomes even more clear:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">visNetwork</span>, args <span class="op">=</span> <span class="va">pip</span><span class="op">$</span><span class="fu">get_graph</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visHierarchicalLayout.html" class="external-link">visHierarchicalLayout</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"LR"</span>, sortMethod <span class="op">=</span> <span class="st">"directed"</span><span class="op">)</span></span></code></pre></div>
<div class="visNetwork html-widget html-fill-item" id="htmlwidget-36aa3d2a04d42bbc2145" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"nodes":{"id":[1,2,3,4,5,6,7,8,9,10],"label":["data.setosa","fit.setosa","coefs.setosa","data.versicolor","fit.versicolor","coefs.versicolor","data.virginica","fit.virginica","coefs.virginica","combine_coefs"],"group":["setosa","setosa","setosa","versicolor","versicolor","versicolor","virginica","virginica","virginica","combine_coefs"],"shape":["database","box","box","database","box","box","database","box","box","circle"],"color":["lightblue","orange","orange","lightblue","orange","orange","lightblue","orange","orange","lightblue"],"title":["<p><\/p>","<p><\/p>","<p><\/p>","<p><\/p>","<p><\/p>","<p><\/p>","<p><\/p>","<p><\/p>","<p><\/p>","<p><\/p>"]},"edges":{"from":[1,2,3,4,5,6,7,8,9],"to":[2,3,10,5,6,10,8,9,10],"arrows":["to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot"},"manipulation":{"enabled":false},"layout":{"hierarchical":{"enabled":true,"direction":"LR","sortMethod":"directed"}}},"groups":["setosa","versicolor","virginica","combine_coefs"],"width":null,"height":null,"idselection":{"enabled":false},"byselection":{"enabled":false},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)"},"evals":[],"jsHooks":[]}</script><p>Finally, let’s see how this plays out when we run the pipeline.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pip</span><span class="op">$</span><span class="fu">set_params</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>xVar <span class="op">=</span> <span class="st">"Sepal.Length"</span>, yVar <span class="op">=</span> <span class="st">"Sepal.Width"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pip</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:09.360] Start run of 'my-pipeline' pipeline:</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:09.361] Step 1/10 data.setosa</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:09.364] Step 2/10 fit.setosa</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:09.367] Step 3/10 coefs.setosa</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:09.368] Step 4/10 data.versicolor</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:09.371] Step 5/10 fit.versicolor</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:09.374] Step 6/10 coefs.versicolor</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:09.376] Step 7/10 data.virginica</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:09.378] Step 8/10 fit.virginica</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:09.381] Step 9/10 coefs.virginica</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:09.383] Step 10/10 combine_coefs</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:09.386] Finished execution of steps.</span></span>
<span><span class="co"># INFO  [2024-12-01 17:14:09.386] Done.</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pip</span><span class="op">$</span><span class="fu">collect_out</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># $combine_coefs</span></span>
<span><span class="co">#                  (Intercept) Sepal.Length</span></span>
<span><span class="co"># coefs.setosa      -0.5694327    0.7985283</span></span>
<span><span class="co"># coefs.versicolor   0.8721460    0.3197193</span></span>
<span><span class="co"># coefs.virginica    1.4463054    0.2318905</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://rpahl.github.io/r-some-blog/about.html" class="external-link">Roman Pahl</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
